# OpenEvolve Default Configuration
# This file contains all available configuration options with sensible defaults
# You can use this as a template for your own configuration

# General settings
max_iterations: 10 # Maximum number of evolution iterations
checkpoint_interval: 1 # Save checkpoints every N iterations
log_level: "DEBUG" # Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
log_dir: null # Custom directory for logs (default: output_dir/logs)
random_seed: 42 # Random seed for reproducibility (null = random, 42 = default)
language: "tla" # Hint templates/formatting for TLA+/PlusCal
file_suffix: ".tla" # Ensure .tla is used for saved programs

# Evolution settings
diff_based_evolution: true # Use diff-based evolution (true) or full rewrites (false)
max_code_length: 10000 # Maximum allowed code length in characters

# Early stopping settings
early_stopping_patience: null # Stop after N iterations without improvement (null = disabled)
convergence_threshold: 0.001 # Minimum improvement required to reset patience counter
early_stopping_metric: "combined_score" # Metric to track for early stopping

# LLM configuration
llm:
  # Models for evolution
  models:
    # List of available models with their weights
    - name: "gpt-5"
      weight: 1

  # Models for LLM feedback
  evaluator_models:
    # List of available models with their weights
    - name: "gpt-5"
      weight: 1

  # Generation parameters
  # temperature: 0.7 # Temperature for generation (higher = more creative)
  # top_p: 0.95 # Top-p sampling parameter
  # max_tokens: 4096 # Maximum tokens to generate

  # Request parameters
  timeout: 180 # Timeout for API requests in seconds
  retries: 3 # Number of retries for failed requests
  retry_delay: 5 # Delay between retries in seconds

# Prompt configuration
prompt:
  template_dir: null # Custom directory for prompt templates
  system_message: |
    ## Goal
    - Translate with pcal.trans and pass all .cfg checks. No commentary.
    - Algorithmic task: Implement a single-process counter.
      Initialize x = 0; when x < 10, increment x by 1; never exceed 10.
      Preserve SafeBounds (x ∈ 0..10) and satisfy CountsUp:
      ∀ k ∈ 0..9: (x = k) ~> (x = k + 1) under WF_vars(Next).

    ## Scoring rubric (this task)
    - combined_score 100: TLC reports "No error has been found" (valid spec).
    - combined_score 50: PlusCal translated but TLC found violations/deadlock/runtime errors.
    - combined_score 0: PlusCal translation failed or evaluation error.
    - Target: raise combined_score to 100 via minimal, property-preserving edits.

    ## Artifact hints
    - translator_stdout/stderr: fix PlusCal syntax/label/structure errors first.
    - tlc_stdout: fix invariants/properties/fairness/deadlock by adjusting algorithm (not properties).

    ## Scope
    - Do not change module header, EXTENDS, CONSTANT(S), TLA+ operators, Init/Next/Spec, fairness, or property definitions.
    - Keep identifiers referenced by properties/.cfg unchanged (e.g., labels like CS, variables).

    ## PlusCal rules
    - Use C-style braces; end every statement with ';'.
    - Declarations: single `variables ...` line; locals via `variable x = Expr;`.
    - Common: await, assert, skip, call, return, goto. Expressions use TLA+ syntax (\in, /\, \/, ~).
    - Label atomic steps and after call/return/goto. Use `process <Name> \in <Set>` and `self`.
    - Preserve existing indentation and whitespace.

    ## Name safety
    - Do not introduce: `pc`, `vars`, `ProcSet`, `defaultInitValue`, `Init`, `Next`, `Spec`, `TLATrans_*`.

    ## Properties to honor
    - Safety, temporal, fairness, deadlock/termination; refinement/security if present.
    - Do not weaken/rename/delete properties or model parameters.

    ## Change strategy
    - Property-preserving edits.
    - Maintain frames (keep untouched variables unchanged).
    - Genuine progress; align enabledness with fairness; keep types tight.

    ## Forbidden
    - Renaming identifiers used by properties/.cfg; changing properties/.cfg; dummy steps; disabling deadlock.

    ## Self-check
    - Safety, Temporal, Fairness, Deadlock, Refinement/Security (if present).
    - If impossible, add: `// UNSAT: <one-line reason>`.

  # evaluator_system_message: |
  #   You are an expert PlusCal/TLA+ reviewer.
  #   Judge programs strictly on whether all invariants hold without any edits to
  #   their definitions. Responses that change invariant text or names should be
  #   considered invalid.

  # Number of examples to include in the prompt
  num_top_programs: 3 # Number of top-performing programs to include
  num_diverse_programs: 2 # Number of diverse programs to include

  # Template stochasticity
  use_template_stochasticity: false # Use random variations in templates for diversity
  template_variations: # Different phrasings for parts of the template
    improvement_suggestion:
      - "Here's how we could improve this code:"
      - "I suggest the following improvements:"
      - "We can enhance this code by:"

  # Artifact rendering
  include_artifacts: true # Include execution outputs/errors in prompt
  max_artifact_bytes: 20480 # Maximum artifact size in bytes (20KB default)
  artifact_security_filter: true # Apply security filtering to artifacts

  # Feature extraction and program labeling thresholds
  # These control how the LLM perceives and categorizes programs
  # suggest_simplification_after_chars: 500 # Suggest simplifying if program exceeds this many characters
  # include_changes_under_chars: 100 # Include change descriptions in features if under this length
  # concise_implementation_max_lines: 10 # Label as "concise" if program has this many lines or fewer
  # comprehensive_implementation_min_lines: 50 # Label as "comprehensive" if program has this many lines or more

  # Note: meta-prompting features are not yet implemented

# Database configuration
database:
  # General settings
  db_path: null # Path to persist database (null = in-memory only)
  in_memory: true # Keep database in memory for faster access
  log_prompts: true # If true, log all prompts and responses into the database

  # Evolutionary parameters
  population_size: 1000 # Maximum number of programs to keep in memory
  archive_size: 100 # Size of elite archive
  num_islands: 5 # Number of islands for island model (separate populations)

  # Island-based evolution parameters
  # Islands provide diversity by maintaining separate populations that evolve independently.
  # Migration periodically shares the best solutions between adjacent islands.
  migration_interval: 50 # Migrate between islands every N generations
  migration_rate: 0.1 # Fraction of top programs to migrate (0.1 = 10%)

  # Selection parameters
  elite_selection_ratio: 0.1 # Ratio of elite programs to select
  exploration_ratio: 0.2 # Ratio of exploration vs exploitation
  exploitation_ratio: 0.7 # Ratio of exploitation vs random selection
  # Note: diversity_metric is fixed to "edit_distance" (feature_based not implemented)

  # Feature map dimensions for MAP-Elites
  # Default if not specified: ["complexity", "diversity"]
  #
  # Built-in features (always available, computed by OpenEvolve):
  #   - "complexity": Code length
  #   - "diversity": Code structure diversity
  #
  # You can mix built-in features with custom metrics from your evaluator:
  feature_dimensions: # Dimensions for MAP-Elites feature map (for diversity, NOT fitness)
    - "complexity" # Code length (built-in)
    - "diversity" # Code diversity (built-in)
  # Example with custom features:
  # feature_dimensions:
  #   - "performance"                 # Must be returned by your evaluator
  #   - "correctness"                 # Must be returned by your evaluator
  #   - "memory_efficiency"           # Must be returned by your evaluator

  # Number of bins per dimension
  # Can be a single integer (same for all dimensions) or a dict
  feature_bins: 10 # Number of bins per dimension
  # Example of per-dimension configuration:
  # feature_bins:
  #   complexity: 10                  # 10 bins for complexity
  #   diversity: 15                   # 15 bins for diversity
  #   performance: 20                 # 20 bins for custom metric

  diversity_reference_size: 20 # Size of reference set for diversity calculation

# Evaluator configuration
evaluator:
  # Fitness calculation: Uses 'combined_score' if available, otherwise averages
  # all metrics EXCEPT those listed in database.feature_dimensions

  # General settings
  timeout: 1500 # Maximum evaluation time in seconds
  max_retries: 3 # Maximum number of retries for evaluation

  # Note: resource limits (memory_limit_mb, cpu_limit) are not yet implemented

  # Evaluation strategies
  cascade_evaluation: false # Use cascade evaluation to filter bad solutions early
  cascade_thresholds: # Thresholds for advancing to next evaluation stage
    - 0.5 # First stage threshold
    - 0.75 # Second stage threshold
    - 0.9 # Third stage threshold

  # Parallel evaluation
  parallel_evaluations: 3 # Number of parallel evaluations
  # Note: distributed evaluation is not yet implemented

  # LLM-based feedback (experimental)
  use_llm_feedback: false # Use LLM to evaluate code quality
  llm_feedback_weight: 0.1 # Weight for LLM feedback in final score

# Evolution trace configuration
# Logs detailed traces of program evolution for RL training and analysis
evolution_trace:
  enabled: false # Enable evolution trace logging
  format: "jsonl" # Output format: 'jsonl', 'json', or 'hdf5'
  include_code: true # Include full program code in traces
  include_prompts: true # Include prompts and LLM responses
  output_path: null # Path for trace output (defaults to output_dir/evolution_trace.{format})
  buffer_size: 10 # Number of traces to buffer before writing
  compress: false # Compress output file (jsonl only)
